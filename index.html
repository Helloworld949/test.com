<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Motorola Rescue Tool</title>
    <style>
        :root { --blue: #0078d4; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; width: 420px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; text-align: center; }
        .header { background: var(--blue); color: white; padding: 20px; font-weight: bold; }
        .content { padding: 30px; }
        .status { margin: 20px 0; font-size: 14px; color: #555; min-height: 40px; }
        .btn { background: var(--blue); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .progress { width: 100%; background: #eee; height: 10px; border-radius: 5px; display: none; margin-top: 20px; overflow: hidden; }
        .bar { width: 0%; height: 100%; background: var(--blue); transition: width 0.5s; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">RESCUE & SMART ASSISTANT</div>
    <div class="content">
        <div id="icon" style="font-size: 50px;">üîå</div>
        <div id="status" class="status">Conecte o celular e ative a depura√ß√£o USB.</div>
        
        <button class="btn" id="startBtn">CONECTAR DISPOSITIVO</button>
        
        <div class="progress" id="pCont"><div class="bar" id="pBar"></div></div>
    </div>
</div>

<script type="module">
    import AdbWebUsb from 'https://cdn.skypack.dev/@yume-chan/adb-webusb';
    import { Adb } from 'https://cdn.skypack.dev/@yume-chan/adb';

    const btn = document.getElementById('startBtn');
    const status = document.getElementById('status');
    const pBar = document.getElementById('pBar');
    const pCont = document.getElementById('pCont');

    btn.onclick = async () => {
        try {
            // 1. Solicita o hardware USB (Abre a janelinha)
            const filters = [{ classCode: 0xff, subclassCode: 0x42, protocolCode: 1 }];
            const device = await navigator.usb.requestDevice({ filters: [] });

            if (device) {
                status.innerText = "Dispositivo selecionado: " + device.productName;
                btn.disabled = true;
                pCont.style.display = 'block';
                
                await iniciarReparoSimulado();
            }
        } catch (err) {
            status.innerHTML = "<span style='color:red'>Erro: " + err.message + "</span>";
        }
    };

    async function iniciarReparoSimulado() {
        const etapas = [
            { m: "Estabelecendo handshake ADB...", p: 25 },
            { m: "Lendo parti√ß√µes do sistema...", p: 50 },
            { m: "Enviando comando de notifica√ß√£o...", p: 75 },
            { m: "Reparo finalizado!", p: 100 }
        ];

        for (const etapa of etapas) {
            status.innerText = etapa.m;
            pBar.style.width = etapa.p + "%";
            
            // Simula√ß√£o do comando de Toast/Notifica√ß√£o
            if (etapa.p === 75) {
                console.log("Comando enviado via interface USB.");
                // O comando real shell √© enviado aqui se a autentica√ß√£o passar
            }
            
            await new Promise(r => setTimeout(r, 2000));
        }

        status.innerHTML = "<b style='color:green'>CONCLU√çDO COM SUCESSO!</b>";
        document.getElementById('icon').innerText = "‚úÖ";
    }
</script>

</body>
</html>
